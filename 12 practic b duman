import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;


class ПлатежныйШлюз {
    public boolean проверитьПлатеж(double сумма, String способОплаты) {
        if ("Онлайн".equals(способОплаты)) {
            return сумма > 0 && Math.random() > 0.1;
        }
        return true;
    }
}



class Склад {
    private Map<String, Integer> наличиеТоваров = new HashMap<>();

    public Склад() {
        наличиеТоваров.put("Ноутбук", 10);
        наличиеТоваров.put("Мышь", 50);
    }

    public boolean проверитьНаличие(String товар, int количество) {
        return наличиеТоваров.getOrDefault(товар, 0) >= количество;
    }

    public void собратьЗаказ(Заказ заказ) {
        for (Map.Entry<String, Integer> item : заказ.списокТоваров.entrySet()) {
            наличиеТоваров.computeIfPresent(item.getKey(), (k, v) -> v - item.getValue());
        }
    }
}

class КурьерскаяСлужба {
    public boolean отправитьЗаявку(Заказ заказ) {
        return true;
    }

    public void доставитьТовар(Заказ заказ) {
        заказ.статус = "Доставлен";
    }
}

class Заказ {
    private int id;
    public double общаяСумма;
    public Map<String, Integer> списокТоваров = new HashMap<>();
    public String статус = "Создан";
    public String способДоставки;
    public String способОплаты;

    public Заказ(int id, double сумма, String товар, int количество) {
        this.id = id;
        this.общаяСумма = сумма;
        списокТоваров.put(товар, количество);
    }
}

class СистемаЛогистики {
    private Склад склад;
    private ПлатежныйШлюз платежныйШлюз;
    private КурьерскаяСлужба курьерскаяСлужба;

    public СистемаЛогистики(Склад склад, ПлатежныйШлюз платежныйШлюз, КурьерскаяСлужба курьерскаяСлужба) {
        this.склад = склад;
        this.платежныйШлюз = платежныйШлюз;
        this.курьерскаяСлужба = курьерскаяСлужба;
    }

    public String обработатьЗаказ(Заказ заказ, String способОплаты, String способДоставки) {
        заказ.способОплаты = способОплаты;
        заказ.способДоставки = способДоставки;

        for (Map.Entry<String, Integer> item : заказ.списокТоваров.entrySet()) {
            if (!склад.проверитьНаличие(item.getKey(), item.getValue())) {
                return "Клиент: Уведомление о недоступности " + item.getKey() + ". Предложение изменить заказ.";
            }
        }
        заказ.статус = "Подтвержден";

        if ("Онлайн".equals(способОплаты)) {
            if (!платежныйШлюз.проверитьПлатеж(заказ.общаяСумма, способОплаты)) {
                return "Клиент: Уведомление: Платеж отклонен. Повторите оплату.";
            }
        }

        склад.собратьЗаказ(заказ);
        заказ.статус = "Собран";

        if ("Курьерская служба".equals(способДоставки)) {
            курьерскаяСлужба.отправитьЗаявку(заказ);
            заказ.статус = "В доставке";
            курьерскаяСлужба.доставитьТовар(заказ);
        } else if ("Самовывоз".equals(способДоставки)) {
            return "Клиент: Уведомление о готовности заказа к самовывозу.";
        }

        if ("Доставлен".equals(заказ.статус)) {
            return "Клиент: Заказ завершен. Электронный чек отправлен.";
        }
        return "Заказ в статусе: " + заказ.статус;
    }
}


class ПользовательКурса {
    private String имя;
    public String статусДоступа = "Нет";
    public int результатТеста = 0;

    public ПользовательКурса(String имя) {
        this.имя = имя;
    }

    public void setСтатусДоступа(String статус) { this.статусДоступа = статус; }
    public void setРезультатТеста(int результат) { this.результатТеста = результат; }
    public void скачатьСертификат() {}
}

class КурсОнлайн {
    private String название;
    private boolean доступен;

    public КурсОнлайн(String название, boolean доступен) {
        this.название = название;
        this.доступен = доступен;
    }

    public boolean проверитьДоступность() { return доступен; }
}

class БазаДанных {
    private List<String> записиОЗавершении = new ArrayList<>();

    public void сохранитьДанныеОЗавершении(ПользовательКурса пользователь) {
        записиОЗавершении.add("Пользователь " + пользователь.имя + " завершил курс.");
    }
}

class СистемаОнлайнКурсов {
    private ПлатежныйШлюз платежныйШлюз;
    private БазаДанных базаДанных;

    public СистемаОнлайнКурсов(ПлатежныйШлюз платежныйШлюз, БазаДанных базаДанных) {
        this.платежныйШлюз = платежныйШлюз;
        this.базаДанных = базаДанных;
    }

    public String регистрацияНаКурс(ПользовательКурса пользователь, КурсОнлайн курс, double стоимость) {
        if (!курс.проверитьДоступность()) {
            return "Пользователь: Уведомление: Курс недоступен.";
        }
        
        // Имитация выбора оплаты
        String способОплаты = "Онлайн";
        
        if ("Онлайн".equals(способОплаты)) {
            if (!платежныйШлюз.проверитьПлатеж(стоимость, способОплаты)) {
                return "Пользователь: Уведомление: Платеж отклонен. Повторите оплату.";
            }
        }
        
        пользователь.setСтатусДоступа("Активен");
        return "Пользователь: Доступ к курсу активирован.";
    }

    public String прохождениеКурса(ПользовательКурса пользователь) {
        if (!"Активен".equals(пользователь.статусДоступа)) {
            return "Доступ к курсу не активен.";
        }
        
       
        пользователь.setРезультатТеста((int) (Math.random() * 100)); 

        if (пользователь.результатТеста >= 70) {
            String результат = "Пользователь: Сертификат. Результат: " + пользователь.результатТеста + ".";
            
            // Параллельные действия: скачивание сертификата и сохранение в БД
            пользователь.скачатьСертификат();
            базаДанных.сохранитьДанныеОЗавершении(пользователь);

            return результат;
        } else {
            return "Пользователь: Уведомление: Результат " + пользователь.результатТеста + ". Предложение пересдать тесты.";
        }
    }
}
